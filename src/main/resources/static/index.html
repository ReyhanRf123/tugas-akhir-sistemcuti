<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Cuti Karyawan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f8f9fa; }
        .card { margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h1 class="text-center mb-4">Sistem Pengajuan Cuti</h1>

    <div class="card">
        <div class="card-header bg-primary text-white">Form Ajukan Cuti</div>
        <div class="card-body">
            <form id="formCuti">
                <div class="mb-3">
                    <label>ID Karyawan (Contoh: 1)</label>
                    <input type="number" id="karyawanId" class="form-control" value="1" required>
                </div>
                <div class="row">
                    <div class="col">
                        <label>Tanggal Mulai</label>
                        <input type="date" id="tglMulai" class="form-control" required>
                    </div>
                    <div class="col">
                        <label>Tanggal Selesai</label>
                        <input type="date" id="tglSelesai" class="form-control" required>
                    </div>
                </div>
                <div class="mb-3 mt-3">
                    <label>Alasan</label>
                    <textarea id="alasan" class="form-control" rows="2" required></textarea>
                </div>
                <button type="submit" class="btn btn-success">Kirim Pengajuan</button>
            </form>
            <div id="pesanResponse" class="mt-3 alert" style="display:none;"></div>
        </div>
    </div>

    <div class="card">
        <div class="card-header bg-dark text-white">Data Karyawan & Sisa Cuti</div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nama</th>
                        <th>Jabatan</th>
                        <th>Sisa Cuti</th>
                    </tr>
                </thead>
                <tbody id="tabelKaryawan">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // 1. Fungsi untuk mengambil data karyawan dari API (GET)
    async function loadKaryawan() {
        try {
            let response = await fetch('/api/karyawan'); // Panggil Backend
            let data = await response.json();
            
            let html = '';
            data.forEach(k => {
                html += `
                    <tr>
                        <td>${k.id}</td>
                        <td>${k.nama}</td>
                        <td>${k.jabatan}</td>
                        <td><strong>${k.sisaCuti} Hari</strong></td>
                    </tr>
                `;
            });
            document.getElementById('tabelKaryawan').innerHTML = html;
        } catch (error) {
            console.error('Error:', error);
        }
    }

    // 2. Fungsi saat tombol Submit ditekan (POST)
    document.getElementById('formCuti').addEventListener('submit', async (e) => {
        e.preventDefault(); // Mencegah reload halaman

        // Siapkan data JSON sesuai format Thunder Client tadi
        let dataPengajuan = {
            karyawan: { id: document.getElementById('karyawanId').value },
            tanggalMulai: document.getElementById('tglMulai').value,
            tanggalSelesai: document.getElementById('tglSelesai').value,
            alasan: document.getElementById('alasan').value
        };

        // Kirim ke Backend
        try {
            let response = await fetch('/api/ajukan-cuti', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dataPengajuan)
            });

            let text = await response.text(); // Baca respon string dari backend
            
            // Tampilkan pesan
            let alertBox = document.getElementById('pesanResponse');
            alertBox.style.display = 'block';
            alertBox.innerText = text;

            if (text.includes("Sukses")) {
                alertBox.className = 'mt-3 alert alert-success';
                loadKaryawan(); // Refresh tabel otomatis biar sisa cuti berkurang
            } else {
                alertBox.className = 'mt-3 alert alert-danger';
            }

        } catch (error) {
            alert('Terjadi kesalahan koneksi');
        }
    });

    // Panggil fungsi load saat halaman pertama kali dibuka
    loadKaryawan();
</script>

</body>
</html>